<!DOCTYPE html>
<html style="height: 100%">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>J.A.R.V.I.S</title>
    <link rel="shortcut icon" href="/favicon" />
    <link rel="stylesheet" href="./resource/css/Chart.min.css">
    <link rel="stylesheet" href="./resource/css/main.css" />
</head>

<body class="skin-blue hold-transition sidebar-mini sidebar-collapse">
    <div class="wrapper">
        <header id="header" class="main-header"></header>
        <aside id="sidebar" class="main-sidebar sidebar-dark-primary elevation-4"></aside>

        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            <section class="content-header">
                <h1>
                    <i class="fa fa-tachometer" aria-hidden="true"></i> Dashboard
                    <small>Console of Waste Sorting Robot</small>
                </h1>
                <ol class="breadcrumb">
                    <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
                    <li class="active">Dashboard </li>
                </ol>
            </section>
            <!-- Main content -->
            <section class="content">
                <!-- Info boxes -->
                <div class="row">
                    <div class="col-md-3 col-sm-6 col-xs-6">
                        <div class="info-box bg-green">
                            <span class="info-box-icon"><i class="fa fa-battery-three-quarters"
                                    aria-hidden="true"></i></span>

                            <div class="info-box-content">
                                <span class="info-box-text">battery</span>
                                <span class="info-box-number">85%</span>

                                <div class="progress">
                                    <div class="progress-bar" style="width: 85%"></div>
                                </div>
                                <span class="progress-description">
                                    Current Mode: High Performance
                                </span>
                            </div>
                            <!-- /.info-box-content -->
                        </div>
                    </div>
                    <!-- /.info-box -->
                    <div class="col-md-3 col-sm-6 col-xs-6">
                        <div class="info-box bg-yellow">
                            <span class="info-box-icon"><i class="fa fa-street-view" aria-hidden="true"></i></span>

                            <div class="info-box-content">
                                <span class="info-box-text">distance</span>
                                <span class="info-box-number">1.231km</span>

                                <div class="progress">
                                    <div class="progress-bar" style="width: 50%"></div>
                                </div>
                                <span class="progress-description">
                                    Total 108km in 18 Days
                                </span>
                            </div>
                            <!-- /.info-box-content -->
                        </div>
                    </div>
                    <!-- /.info-box -->

                    <div class="col-md-3 col-sm-6 col-xs-6">
                        <div class="info-box bg-red">
                            <span class="info-box-icon"><i class="fa fa-recycle" aria-hidden="true"></i></span>

                            <div class="info-box-content">
                                <span class="info-box-text">trash capacity</span>
                                <span class="info-box-number">92%</span>

                                <div class="progress">
                                    <div class="progress-bar" style="width: 92%"></div>
                                </div>
                                <span class="progress-description">
                                    Nearly full
                                </span>
                            </div>
                            <!-- /.info-box-content -->
                        </div>
                    </div>
                    <!-- /.info-box -->
                    <div class="col-md-3 col-sm-6 col-xs-6">
                        <div class="info-box bg-aqua">
                            <span class="info-box-icon"><i class="fa fa-free-code-camp" aria-hidden="true"></i></span>

                            <div class="info-box-content">
                                <span class="info-box-text">accuracy</span>
                                <span class="info-box-number">82%</span>

                                <div class="progress">
                                    <div class="progress-bar" style="width: 82%"></div>
                                </div>
                                <span class="progress-description">
                                    8 error cases
                                </span>
                            </div>
                            <!-- /.info-box-content -->
                        </div>
                    </div>
                </div>
                <!-- /.row -->
                <div class="row">
                    <div class="col-md-12">
                        <div class="box">
                            <div class="box-header with-border">
                                <h3 class="box-title"><i class="fa fa-android" aria-hidden="true"></i> Robot
                                    <a><strong>JARVIS</strong></a> Broadcast
                                </h3>
                                <div class="box-tools pull-right">
                                    <button type="button" class="btn btn-box-tool" data-widget="collapse"><i
                                            class="fa fa-minus"></i>
                                    </button>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-box-tool dropdown-toggle"
                                            data-toggle="dropdown">
                                            <i class="fa fa-wrench"></i></button>
                                        <ul class="dropdown-menu" role="menu">
                                            <li><a href="#">Action</a></li>
                                            <li><a href="#">Another action</a></li>
                                            <li><a href="#">Something else here</a></li>
                                            <li class="divider"></li>
                                            <li><a href="#">Separated link</a></li>
                                        </ul>
                                    </div>
                                    <button type="button" class="btn btn-box-tool" data-widget="remove"><i
                                            class="fa fa-times"></i></button>
                                </div>
                            </div>
                            <!-- /.box-header -->
                            <div class="box-body">
                                <div class="row">
                                    <div class="col-md-7">
                                        <p>
                                            <strong><i class="fa fa-clock-o" aria-hidden="true"></i> Camera Local Time:
                                                <a id="datetime-now">2019/06/15 13:46:57</a></strong>
                                        </p>
                                        <div class="chart">
                                            <img id="img-camera" src="./resource/img/camera.jpg"
                                                style="width: 100%; max-height: 480px" />
                                        </div>
                                        <!-- /.chart-responsive -->
                                    </div>
                                    <!-- /.col -->
                                    <div class="col-md-5">
                                        <p>
                                            <strong><i class="fa fa-cogs" aria-hidden="true"></i> Performance</strong>
                                        </p>
                                        <div class="row">
                                            <div class="col-xs-5">
                                                <div class="progress-group">
                                                    <span class="progress-text">capacity</span>
                                                    <span class="progress-number"><b>16</b> / 64GB</span>

                                                    <div class="progress sm">
                                                        <div class="progress-bar progress-bar-aqua" style="width: 25%">
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- /.progress-group -->
                                                <div class="progress-group">
                                                    <span class="progress-text">garbage</span>
                                                    <span class="progress-number"><b>28</b>/40</span>

                                                    <div class="progress sm">
                                                        <div class="progress-bar progress-bar-yellow" style="width: 70%">
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- /.progress-group -->
                                                <div class="progress-group">
                                                    <span class="progress-text">human</span>
                                                    <span class="progress-number"><b>6</b>/8</span>

                                                    <div class="progress sm">
                                                        <div class="progress-bar progress-bar-green" style="width: 76%">
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- /.progress-group -->
                                                <div class="progress-group">
                                                    <span class="progress-text">error</span>
                                                    <span class="progress-number"><b>8</b>/76</span>

                                                    <div class="progress sm">
                                                        <div class="progress-bar progress-bar-red"
                                                            style="width: 18%">
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- /.progress-group -->
                                            </div>
                                            <!-- /.col -->
                                            <div class="col-xs-7">
                                                <div class="chart-responsive">
                                                    <canvas id="pieChart" style="height:250px"></canvas>
                                                </div>
                                                <!-- ./chart-responsive -->
                                            </div>
                                        </div>
                                        <div class="row">
                                            <!-- Conversations are loaded here -->
                                            <div class="direct-chat-messages" style="height: 300px">
                                                <!-- Message to the right -->
                                                <div class="direct-chat-msg right">
                                                    <div class="direct-chat-info clearfix">
                                                        <span class="direct-chat-name pull-right">Human Iron Man</span>
                                                        <span class="direct-chat-timestamp pull-left">2019/6/16
                                                            14:01:01</span>
                                                    </div>
                                                    <!-- /.direct-chat-info -->
                                                    <img class="direct-chat-img" src="./resource/img/avatar-human.png"
                                                        alt="human">
                                                    <!-- /.direct-chat-img -->
                                                    <div class="direct-chat-text">
                                                        Hello, Jarvis
                                                    </div>
                                                    <!-- /.direct-chat-text -->
                                                </div>
                                                <!-- /.direct-chat-msg -->

                                                <!-- Message. Default to the left -->
                                                <div class="direct-chat-msg">
                                                    <div class="direct-chat-info clearfix">
                                                        <span class="direct-chat-name pull-left">Robot Jarvis</span>
                                                        <span class="direct-chat-timestamp pull-right">2019/6/16
                                                            14:01:30</span>
                                                    </div>
                                                    <!-- /.direct-chat-info -->
                                                    <img class="direct-chat-img" src="./resource/img/avatar-jarvis.png"
                                                        alt="jarvis">
                                                    <!-- /.direct-chat-img -->
                                                    <div class="direct-chat-text">
                                                        Hi Iron man, I'm coming in.
                                                    </div>
                                                    <!-- /.direct-chat-text -->
                                                </div>
                                                <!-- /.direct-chat-msg -->

                                                <!-- Message. Default to the left -->
                                                <div class="direct-chat-msg">
                                                    <div class="direct-chat-info clearfix">
                                                        <span class="direct-chat-name pull-left">Robot Jarvis</span>
                                                        <span class="direct-chat-timestamp pull-right">2019/6/16
                                                            14:02:10</span>
                                                    </div>
                                                    <!-- /.direct-chat-info -->
                                                    <img class="direct-chat-img" src="./resource/img/avatar-jarvis.png"
                                                        alt="jarvis">
                                                    <!-- /.direct-chat-img -->
                                                    <div class="direct-chat-text">
                                                        This is recyclable garbage, let me help you throw.
                                                    </div>
                                                    <!-- /.direct-chat-text -->
                                                </div>
                                                <!-- /.direct-chat-msg -->

                                                <!-- Message. Default to the left -->
                                                <div class="direct-chat-msg">
                                                    <div class="direct-chat-info clearfix">
                                                        <span class="direct-chat-name pull-left">Robot Jarvis</span>
                                                        <span class="direct-chat-timestamp pull-right">2019/6/16
                                                            14:03:15</span>
                                                    </div>
                                                    <!-- /.direct-chat-info -->
                                                    <img class="direct-chat-img" src="./resource/img/avatar-jarvis.png"
                                                        alt="jarvis">
                                                    <!-- /.direct-chat-img -->
                                                    <div class="direct-chat-text">
                                                        Finished, please call me if any other garbage.
                                                    </div>
                                                    <!-- /.direct-chat-text -->
                                                </div>
                                                <!-- /.direct-chat-msg -->

                                                <!-- Message to the right -->
                                                <div class="direct-chat-msg right">
                                                    <div class="direct-chat-info clearfix">
                                                        <span class="direct-chat-name pull-right">Human Iron Man</span>
                                                        <span class="direct-chat-timestamp pull-left">2019/6/16
                                                            14:03:20</span>
                                                    </div>
                                                    <!-- /.direct-chat-info -->
                                                    <img class="direct-chat-img" src="./resource/img/avatar-human.png"
                                                        alt="human">
                                                    <!-- /.direct-chat-img -->
                                                    <div class="direct-chat-text">
                                                       Well done.
                                                    </div>
                                                    <!-- /.direct-chat-text -->
                                                </div>
                                                <!-- /.direct-chat-msg -->

                                            </div>
                                            <!--/.direct-chat-messages-->
                                        </div>
                                        <!-- /.col -->
                                    </div>
                                    <!-- /.row -->
                                </div>
                                <!-- ./box-body -->
                            </div>
                            <!-- /.box -->
                        </div>
                        <!-- /.col -->
                    </div>
                    <!-- /.row -->
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <!-- USERS LIST -->
                        <div class="box box-danger">
                            <div class="box-header with-border">
                                <h3 class="box-title"><i class="fa fa-camera-retro" aria-hidden="true"></i> Latest
                                    Recognized Cases</h3>

                                <div class="box-tools pull-right">
                                    <span class="label label-danger">8 Error Cases</span>
                                    <button type="button" class="btn btn-box-tool" data-widget="collapse"><i
                                            class="fa fa-minus"></i>
                                    </button>
                                    <button type="button" class="btn btn-box-tool" data-widget="remove"><i
                                            class="fa fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            <!-- /.box-header -->
                            <div class="box-body no-padding" id="pnl-cases-list">
                                <ul class="users-list clearfix">
                                    <!-- <li>
                                        <img src="./resource/img/temp-case1.jpg" alt="case">
                                        <a class="users-list-name" href="#">
                                            <span class="label label-success">DRY 0.89</span> Bulbasaur</a>
                                        <span class="users-list-date">2019/6/15 12:47:35</span>
                                    </li>
                                    <li>
                                        <img src="./resource/img/temp-case2.jpg" alt="case">
                                        <a class="users-list-name" href="#"><span class="label label-warning">WET
                                                0.86</span> Charmander</a>
                                        <span class="users-list-date">2019/6/15 12:47:35</span>
                                    </li>
                                    <li>
                                        <img src="./resource/img/temp-case3.jpg" alt="case" class="error">
                                        <a class="users-list-name" href="#"><span class="label label-info">RECYCLABLE
                                                0.45</span> Squirtle</a>
                                        <span class="users-list-date">2019/6/15 12:47:35</span>
                                    </li>
                                    <li>
                                        <img src="./resource/img/temp-case4.jpg" alt="case" class="error">
                                        <a class="users-list-name" href="#"><span class="label label-danger">HAZARDOUS
                                                0.34</span> Caterpie</a>
                                        <span class="users-list-date">2019/6/15 12:47:35</span>
                                    </li>
                                    <li>
                                        <img src="./resource/img/temp-case5.jpg" alt="case">
                                        <a class="users-list-name" href="#"><span class="label label-danger">HAZARDOUS
                                                0.78</span> Rattata</a>
                                        <span class="users-list-date">2019/6/15 12:47:35</span>
                                    </li>
                                    <li>
                                        <img src="./resource/img/temp-case6.jpg" alt="case">
                                        <a class="users-list-name" href="#"><span class="label label-warning">WET
                                                0.95</span> Pikachu</a>
                                        <span class="users-list-date">2019/6/15 12:47:35</span>
                                    </li> -->
                                </ul>
                                <!-- /.users-list -->
                            </div>
                            <!-- /.box-body -->
                            <div class="box-footer text-center">
                                <a href="javascript:void(0)" class="uppercase">View All Cases</a>
                            </div>
                            <!-- /.box-footer -->
                        </div>
                        <!--/.box -->
                    </div>
                    <!-- /.row -->
                </div>
            </section>
            <!-- /.content -->
        </div>

        <!-- Main Footer -->
        <footer id="footer" class="main-footer"></footer>
    </div>
    <!-- ./wrapper -->

    <!-- REQUIRED SCRIPTS -->
    <script src="./resource/js/jquery.min.js"></script>
    <script src="./resource/js/Chart.min.js"></script>
    <script src="./resource/js/main.js"></script>

    <script type="text/javascript">
        $(function () {
            // Datetime Now
            function checkTime(i) {
                if (i < 10) {
                    i = "0" + i;
                }
                return i;
            }

            function startTime() {
                var today = new Date();
                var y = today.getFullYear();
                var mon = today.getMonth() + 1;
                var d = today.getDate();
                var h = today.getHours();
                var m = today.getMinutes();
                var s = today.getSeconds();
                // add a zero in front of numbers<10
                m = checkTime(m);
                s = checkTime(s);
                $("#datetime-now").text(`${y}/${mon}/${d} ${h}:${m}:${s}`);
                t = setTimeout(function () {
                    startTime()
                }, 1000);
            }

            startTime();

            // websocket
            var $cam = $("#img-camera");
            var ws = new WebSocket("ws://192.168.199.241:50010/web");
            ws.onmessage = () => {
                $cam.prop('src', event.data);
            }
            ws.onclose = () => {
                if (this._reconnent) {
                    let interv = this.generateInterval(this._attempt);
                    this._attempt++;
                    let own = this;
                    setTimeout(() => {
                        own.tryConnect()
                    }, interv);
                }
            }

            //-------------
            //- PIE CHART -
            //-------------
            // Get context with jQuery - using jQuery's .get() method.
            var randomScalingFactor = function () {
                return Math.round(Math.random() * 100);
            };

            var config = {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [
                            randomScalingFactor(),
                            randomScalingFactor(),
                            randomScalingFactor(),
                            randomScalingFactor(),
                        ],
                        backgroundColor: ['#f39c12', '#00a65a', '#00c0ef', '#dd4b39'],
                    }],
                    labels: [
                        'Dry',
                        'Wet',
                        'Recylable',
                        'Hazardous',
                    ]
                },
                options: {
                    responsive: true,
                    legend: {
                        position: 'bottom',
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true
                    },
                    circumference: Math.PI,
                    rotation: -Math.PI,
                }
            };

            var ctx = $("#pieChart").get(0).getContext('2d');
            window.myDoughnut = new Chart(ctx, config);
            myDoughnut.update();


            // Get Configs
            $.post('/api/init', function (d, status) {
                if (status === 'success' && d) {
                    console.log(d);
                    $("#pnl-cases-list>ul").empty();
                    $.each(d.data.CASE, function (i, obj) {
                        let item = $("<li />")
                            .append($("<img />", {
                                src: `./resource/img/${obj.IMG}`,
                                class: obj.ERROR ? 'error' : ''
                            }))
                            .append($(
                                `<a><span class="label label-${obj.STYLE}">${obj.CATEGORY} ${obj.CONFIDENCE}</span> ${obj.NAME}</a>`, {
                                    class: "users-list-name",
                                    href: "#"
                                }
                            ))
                            .append($(
                                `<span>${obj.TIMESTAMP}</span>`, {
                                    class: "users-list-date"
                                }
                            ));
                        $("#pnl-cases-list>ul").append(item);
                    });
                } else {
                    alert(status);
                }
            });
        });
    </script>
</body>

</html>